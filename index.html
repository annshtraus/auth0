<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Auth0 Sample</title>
    <script>
        var lpGetAuthenticationToken = function (callback) {
            console.log("inside lpGetAuthenticationToken!");
            var token;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    var obj = JSON.parse(xhttp.responseText);
                    token = obj.id_token;
                    console.log("got token! " + token);
                    console.log("calling callback with token...");
                    callback(token);

                }
            };
            xhttp.open("POST", "https://lpsupport.auth0.com/oauth/ro", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send("client_id=6GOQ2EC4ih5s6Xs1G20DBcrCCeWmKeMp&username=baraka%40liveperson.com&password=1&connection=Username-Password-Authentication&grant_type=password&scope=openid&device=");

        }
    </script>

    <script>
        function getURLParams(search) {
            var queryParams = {}, queryArray, singleQuery;
            queryArray = search.substr(1).split("&");
            for (var i = 0; i < queryArray.length; i++) {
                if (queryArray[i].indexOf("=") > -0) {
                    singleQuery = queryArray[i].split("=");
                    if (singleQuery.length == 2) {
                        queryParams[decodeURIComponent(singleQuery[0])] = decodeURIComponent(singleQuery[1]);
                    }
                }
            }
            return queryParams;
        }

        var urlParams = getURLParams(window.location.search) || {};
        var site = urlParams.site || '';
        var redirect_uri = urlParams.redirect_uri ? encodeURIComponent(urlParams.redirect_uri) : 'https%3A%2F%2Fvx-lp.github.io%2Fauth0%2Flogin.html%3Fsite%3D' + site;
        var state = urlParams.state || '{}';
        state = encodeURIComponent(state);
    </script>
    <!-- BEGIN LivePerson Monitor. -->
    <script language="javascript">
        window.lpTag = window.lpTag || {};
        if (typeof window.lpTag._tagCount === 'undefined') {
            window.lpTag = {
                site: site || '',
                section: lpTag.section || '',
                autoStart: lpTag.autoStart === false ? false : true,
                ovr: lpTag.ovr || {domain: 'tlv_plankton3.dev.lprnd.net', tagjs: 'tlv_plankton4.dev.lprnd.net'},
                _v: '1.5.1',
                _tagCount: 1,
                protocol: location.protocol,
                events: {
                    bind: function (app, ev, fn) {
                        lpTag.defer(function () {
                            lpTag.events.bind(app, ev, fn)
                        }, 0)
                    }, trigger: function (app, ev, json) {
                        lpTag.defer(function () {
                            lpTag.events.trigger(app, ev, json)
                        }, 1)
                    }
                },
                defer: function (fn, fnType) {
                    if (fnType == 0) {
                        this._defB = this._defB || [];
                        this._defB.push(fn)
                    } else if (fnType == 1) {
                        this._defT = this._defT || [];
                        this._defT.push(fn)
                    } else {
                        this._defL = this._defL || [];
                        this._defL.push(fn)
                    }
                },
                load: function (src, chr, id) {
                    var t = this;
                    setTimeout(function () {
                        t._load(src, chr, id)
                    }, 0)
                },
                _load: function (src, chr, id) {
                    var url = src;
                    if (!src) {
                        url = this.protocol + '//' + ((this.ovr && this.ovr.domain) ? this.ovr.domain : 'lptag.liveperson.net') + '/tag/tag.js?site=' + this.site
                    }
                    var s = document.createElement('script');
                    s.setAttribute('charset', chr ? chr : 'UTF-8');
                    if (id) {
                        s.setAttribute('id', id)
                    }
                    s.setAttribute('src', url);
                    document.getElementsByTagName('head').item(0).appendChild(s)
                },
                init: function () {
                    this._timing = this._timing || {};
                    this._timing.start = (new Date()).getTime();
                    var that = this;
                    if (window.attachEvent) {
                        window.attachEvent('onload', function () {
                            that._domReady('domReady')
                        })
                    } else {
                        window.addEventListener('DOMContentLoaded', function () {
                            that._domReady('contReady')
                        }, false);
                        window.addEventListener('load', function () {
                            that._domReady('domReady')
                        }, false)
                    }
                    if (typeof(window._lptStop) == 'undefined') {
                        this.load()
                    }
                },
                start: function () {
                    this.autoStart = true
                },
                _domReady: function (n) {
                    if (!this.isDom) {
                        this.isDom = true;
                        this.events.trigger('LPT', 'DOM_READY', {t: n})
                    }
                    this._timing[n] = (new Date()).getTime()
                },
                vars: lpTag.vars || [],
                dbs: lpTag.dbs || [],
                ctn: lpTag.ctn || [],
                sdes: lpTag.sdes || [],
                ev: lpTag.ev || []
            };
            lpTag.init()
        } else {
            window.lpTag._tagCount += 1
        }
        <!-- END LivePerson Monitor. -->
    </script>
</head>
<body style="text-align: center">
<h3>Sign in via:</h3>
<p>
    <a id="lnkCode">
        Code
    </a>
</p>
<p>
    <a id="lnkImplicit">
        Implicit
    </a>
</p>
<script>
    document.getElementById("lnkCode").setAttribute("href", "https://barakauth.auth0.com/authorize?audience=https%3A%2F%2Fbarakauth.auth0.com%2Fapi%2Fv2%2F&client_id=6GOQ2EC4ih5s6Xs1G20DBcrCCeWmKeMp&response_type=code&redirect_uri=" + redirect_uri + '&state=' + state);
    document.getElementById("lnkImplicit").setAttribute("href", "https://barakauth.auth0.com/authorize?response_type=id_token&client_id=6GOQ2EC4ih5s6Xs1G20DBcrCCeWmKeMp&nonce=abc&redirect_uri=" + redirect_uri + '&state=' + state);
</script>
</body>
</html>
